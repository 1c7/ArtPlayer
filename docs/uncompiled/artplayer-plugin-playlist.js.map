{"version":3,"file":"artplayer-plugin-playlist.js","sources":["../../packages/artplayer-plugin-playlist/src/index.js"],"sourcesContent":["import './index.scss';\n\nfunction artplayerPluginPlaylist(art) {\n    const {\n        utils: { append, errorHandle, sleep, inverseClass },\n    } = art.constructor;\n    const {\n        player,\n        events: { proxy },\n        template: { $player, $video },\n    } = art;\n\n    const $playlist = append(\n        $player,\n        `\n        <div class=\"artplay-playlist\">\n            <div class=\"artplay-playlist-inner\"></div>\n        </div>\n    `,\n    );\n\n    let playlist = [];\n    const $playlistInner = $playlist.querySelector('.artplay-playlist-inner');\n\n    function switchUrl(index) {\n        const itemOption = playlist[index];\n        return player.switchUrl(itemOption.url, itemOption.title).then(() => {\n            art.emit('artplayerPluginPlaylist:change', itemOption);\n        });\n    }\n\n    function prevVideo() {\n        const index = playlist.findIndex(item => item.url === $video.src);\n        errorHandle(index !== -1, \"Can't find Playlist item\");\n        if (playlist.length === 1) {\n            return switchUrl(0);\n        }\n        const prevIndex = index - 1 === -1 ? playlist.length - 1 : index - 1;\n        return switchUrl(prevIndex);\n    }\n\n    function nextVideo() {\n        const index = playlist.findIndex(item => item.url === $video.src);\n        errorHandle(index !== -1, \"Can't find Playlist item\");\n        if (playlist.length === 1) {\n            return switchUrl(0);\n        }\n        const nextIndex = index + 1 === playlist.length ? 0 : index + 1;\n        return switchUrl(nextIndex);\n    }\n\n    proxy($playlistInner, 'click', e => {\n        const { optionIndex } = e.target.dataset;\n        if (optionIndex && Number(optionIndex) <= playlist.length - 1) {\n            switchUrl(optionIndex);\n        }\n    });\n\n    proxy($playlist, 'click', e => {\n        if (e.target === $playlist) {\n            $playlist.style.display = 'none';\n        }\n    });\n\n    art.on('video:ended', () => {\n        nextVideo().then(() => {\n            sleep(1000).then(player.play);\n        });\n    });\n\n    art.on('afterAttachUrl', () => {\n        const index = playlist.findIndex(item => item.url === $video.src);\n        const $item = Array.from($playlistInner.children)[index];\n        if (index !== -1 && $item) {\n            inverseClass($item, 'active');\n        }\n    });\n\n    return {\n        name: 'artplayerPluginPlaylist',\n        load(list) {\n            errorHandle(Array.isArray(list), 'Playlist is not an array type');\n            errorHandle(list.length > 0, 'Playlist cannot be empty');\n            playlist = list.map(item => {\n                errorHandle(item.url, 'Playlist items require url attribute');\n                errorHandle(item.title, 'Playlist items require title attribute');\n                return item;\n            });\n            $playlistInner.innerHTML = playlist\n                .map((item, index) => {\n                    return `<div class=\"artplay-playlist-item\" data-option-index=\"${index}\">${item.title}</div>`;\n                })\n                .join('');\n        },\n        show() {\n            $playlist.style.display = 'flex';\n        },\n        hide() {\n            $playlist.style.display = 'none';\n        },\n        next() {\n            nextVideo();\n        },\n        prev() {\n            prevVideo();\n        },\n    };\n}\n\nexport default artplayerPluginPlaylist;\n"],"names":["artplayerPluginPlaylist","art","constructor","utils","append","errorHandle","sleep","inverseClass","player","proxy","events","template","$player","$video","$playlist","playlist","$playlistInner","querySelector","switchUrl","index","itemOption","url","title","then","emit","prevVideo","findIndex","item","src","length","prevIndex","nextVideo","nextIndex","e","optionIndex","target","dataset","Number","style","display","on","play","$item","Array","from","children","name","load","list","isArray","map","innerHTML","join","show","hide","next","prev"],"mappings":"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"}