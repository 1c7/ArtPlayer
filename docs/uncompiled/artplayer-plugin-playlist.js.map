{"version":3,"file":"artplayer-plugin-playlist.js","sources":["../../packages/artplayer-plugin-playlist/src/index.js"],"sourcesContent":["import './index.scss';\n\nfunction artplayerPluginPlaylist(art) {\n    const {\n        utils: { append, errorHandle },\n    } = art.constructor;\n    const {\n        player,\n        events: { proxy },\n        template: { $player, $video },\n    } = art;\n\n    const $playlist = append(\n        $player,\n        `\n        <div class=\"artplay-playlist\">\n            <div class=\"artplay-playlist-inner\"></div>\n        </div>\n    `,\n    );\n\n    const $playlistInner = $playlist.querySelector('.artplay-playlist-inner');\n    let playlist = [];\n\n    art.on('afterAttachUrl', () => {\n        const index = playlist.findIndex(item => item.url === $video.src);\n        const $children = Array.from($playlistInner.children);\n        const $item = $children[index];\n        if (index !== -1 && $item) {\n            $children.forEach(item => item.classList.remove('active'));\n            $item.classList.add('active');\n        }\n    });\n\n    function switchUrl(index) {\n        const itemOption = playlist[index];\n        player.switchUrl(itemOption.url, itemOption.title).then(() => {\n            player.play();\n        });\n    }\n\n    proxy($playlistInner, 'click', e => {\n        const { optionIndex } = e.target.dataset;\n        if (optionIndex && Number(optionIndex) <= playlist.length - 1) {\n            switchUrl(optionIndex);\n        }\n    });\n\n    proxy($playlist, 'click', e => {\n        if (e.target === $playlist) {\n            $playlist.style.display = 'none';\n        }\n    });\n\n    return {\n        name: 'artplayerPluginPlaylist',\n        load(list) {\n            errorHandle(Array.isArray(list), 'Playlist is not an array type');\n            errorHandle(list.length > 0, 'Playlist cannot be empty');\n            playlist = list.map(item => {\n                errorHandle(item.url, 'Playlist items require url attribute');\n                errorHandle(item.title, 'Playlist items require title attribute');\n                return item;\n            });\n            $playlistInner.innerHTML = playlist\n                .map((item, index) => {\n                    return `<div class=\"artplay-playlist-item\" data-option-index=\"${index}\">${item.title}</div>`;\n                })\n                .join('');\n        },\n        show() {\n            $playlist.style.display = 'flex';\n        },\n        hide() {\n            $playlist.style.display = 'none';\n        },\n        next() {\n            const index = playlist.findIndex(item => item.url === $video.src);\n            errorHandle(index !== -1, \"Can't find Playlist item\");\n            if (playlist.length === 1) {\n                switchUrl(0);\n            } else {\n                const nextIndex = index + 1 === playlist.length ? 0 : index + 1;\n                switchUrl(nextIndex);\n            }\n        },\n        prev() {\n            const index = playlist.findIndex(item => item.url === $video.src);\n            errorHandle(index !== -1, \"Can't find Playlist item\");\n            if (playlist.length === 1) {\n                switchUrl(0);\n            } else {\n                const prevIndex = index - 1 === -1 ? playlist.length - 1 : index - 1;\n                switchUrl(prevIndex);\n            }\n        },\n    };\n}\n\nwindow.artplayerPluginPlaylist = artplayerPluginPlaylist;\nexport default artplayerPluginPlaylist;\n"],"names":["artplayerPluginPlaylist","art","constructor","utils","append","errorHandle","player","proxy","events","template","$player","$video","$playlist","$playlistInner","querySelector","playlist","on","index","findIndex","item","url","src","$children","Array","from","children","$item","forEach","classList","remove","add","switchUrl","itemOption","title","then","play","e","optionIndex","target","dataset","Number","length","style","display","name","load","list","isArray","map","innerHTML","join","show","hide","next","nextIndex","prev","prevIndex","window"],"mappings":";;;;;;IAEA,SAASA,uBAAT,CAAiCC,GAAjC,EAAsC;IAAA,8BAG9BA,GAAG,CAACC,WAH0B,CAE9BC,KAF8B;IAAA,MAErBC,MAFqB,yBAErBA,MAFqB;IAAA,MAEbC,WAFa,yBAEbA,WAFa;IAAA,MAK9BC,MAL8B,GAQ9BL,GAR8B,CAK9BK,MAL8B;IAAA,MAMpBC,KANoB,GAQ9BN,GAR8B,CAM9BO,MAN8B,CAMpBD,KANoB;IAAA,sBAQ9BN,GAR8B,CAO9BQ,QAP8B;IAAA,MAOlBC,OAPkB,iBAOlBA,OAPkB;IAAA,MAOTC,MAPS,iBAOTA,MAPS;IAUlC,MAAMC,SAAS,GAAGR,MAAM,CACpBM,OADoB,+HAAxB;IASA,MAAMG,cAAc,GAAGD,SAAS,CAACE,aAAV,CAAwB,yBAAxB,CAAvB;IACA,MAAIC,QAAQ,GAAG,EAAf;IAEAd,EAAAA,GAAG,CAACe,EAAJ,CAAO,gBAAP,EAAyB,YAAM;IAC3B,QAAMC,KAAK,GAAGF,QAAQ,CAACG,SAAT,CAAmB,UAAAC,IAAI;IAAA,aAAIA,IAAI,CAACC,GAAL,KAAaT,MAAM,CAACU,GAAxB;IAAA,KAAvB,CAAd;IACA,QAAMC,SAAS,GAAGC,KAAK,CAACC,IAAN,CAAWX,cAAc,CAACY,QAA1B,CAAlB;IACA,QAAMC,KAAK,GAAGJ,SAAS,CAACL,KAAD,CAAvB;;IACA,QAAIA,KAAK,KAAK,CAAC,CAAX,IAAgBS,KAApB,EAA2B;IACvBJ,MAAAA,SAAS,CAACK,OAAV,CAAkB,UAAAR,IAAI;IAAA,eAAIA,IAAI,CAACS,SAAL,CAAeC,MAAf,CAAsB,QAAtB,CAAJ;IAAA,OAAtB;IACAH,MAAAA,KAAK,CAACE,SAAN,CAAgBE,GAAhB,CAAoB,QAApB;IACH;IACJ,GARD;;IAUA,WAASC,SAAT,CAAmBd,KAAnB,EAA0B;IACtB,QAAMe,UAAU,GAAGjB,QAAQ,CAACE,KAAD,CAA3B;IACAX,IAAAA,MAAM,CAACyB,SAAP,CAAiBC,UAAU,CAACZ,GAA5B,EAAiCY,UAAU,CAACC,KAA5C,EAAmDC,IAAnD,CAAwD,YAAM;IAC1D5B,MAAAA,MAAM,CAAC6B,IAAP;IACH,KAFD;IAGH;;IAED5B,EAAAA,KAAK,CAACM,cAAD,EAAiB,OAAjB,EAA0B,UAAAuB,CAAC,EAAI;IAAA,QACxBC,WADwB,GACRD,CAAC,CAACE,MAAF,CAASC,OADD,CACxBF,WADwB;;IAEhC,QAAIA,WAAW,IAAIG,MAAM,CAACH,WAAD,CAAN,IAAuBtB,QAAQ,CAAC0B,MAAT,GAAkB,CAA5D,EAA+D;IAC3DV,MAAAA,SAAS,CAACM,WAAD,CAAT;IACH;IACJ,GALI,CAAL;IAOA9B,EAAAA,KAAK,CAACK,SAAD,EAAY,OAAZ,EAAqB,UAAAwB,CAAC,EAAI;IAC3B,QAAIA,CAAC,CAACE,MAAF,KAAa1B,SAAjB,EAA4B;IACxBA,MAAAA,SAAS,CAAC8B,KAAV,CAAgBC,OAAhB,GAA0B,MAA1B;IACH;IACJ,GAJI,CAAL;IAMA,SAAO;IACHC,IAAAA,IAAI,EAAE,yBADH;IAEHC,IAAAA,IAFG,gBAEEC,IAFF,EAEQ;IACPzC,MAAAA,WAAW,CAACkB,KAAK,CAACwB,OAAN,CAAcD,IAAd,CAAD,EAAsB,+BAAtB,CAAX;IACAzC,MAAAA,WAAW,CAACyC,IAAI,CAACL,MAAL,GAAc,CAAf,EAAkB,0BAAlB,CAAX;IACA1B,MAAAA,QAAQ,GAAG+B,IAAI,CAACE,GAAL,CAAS,UAAA7B,IAAI,EAAI;IACxBd,QAAAA,WAAW,CAACc,IAAI,CAACC,GAAN,EAAW,sCAAX,CAAX;IACAf,QAAAA,WAAW,CAACc,IAAI,CAACc,KAAN,EAAa,wCAAb,CAAX;IACA,eAAOd,IAAP;IACH,OAJU,CAAX;IAKAN,MAAAA,cAAc,CAACoC,SAAf,GAA2BlC,QAAQ,CAC9BiC,GADsB,CAClB,UAAC7B,IAAD,EAAOF,KAAP,EAAiB;IAClB,kFAAgEA,KAAhE,gBAA0EE,IAAI,CAACc,KAA/E;IACH,OAHsB,EAItBiB,IAJsB,CAIjB,EAJiB,CAA3B;IAKH,KAfE;IAgBHC,IAAAA,IAhBG,kBAgBI;IACHvC,MAAAA,SAAS,CAAC8B,KAAV,CAAgBC,OAAhB,GAA0B,MAA1B;IACH,KAlBE;IAmBHS,IAAAA,IAnBG,kBAmBI;IACHxC,MAAAA,SAAS,CAAC8B,KAAV,CAAgBC,OAAhB,GAA0B,MAA1B;IACH,KArBE;IAsBHU,IAAAA,IAtBG,kBAsBI;IACH,UAAMpC,KAAK,GAAGF,QAAQ,CAACG,SAAT,CAAmB,UAAAC,IAAI;IAAA,eAAIA,IAAI,CAACC,GAAL,KAAaT,MAAM,CAACU,GAAxB;IAAA,OAAvB,CAAd;IACAhB,MAAAA,WAAW,CAACY,KAAK,KAAK,CAAC,CAAZ,EAAe,0BAAf,CAAX;;IACA,UAAIF,QAAQ,CAAC0B,MAAT,KAAoB,CAAxB,EAA2B;IACvBV,QAAAA,SAAS,CAAC,CAAD,CAAT;IACH,OAFD,MAEO;IACH,YAAMuB,SAAS,GAAGrC,KAAK,GAAG,CAAR,KAAcF,QAAQ,CAAC0B,MAAvB,GAAgC,CAAhC,GAAoCxB,KAAK,GAAG,CAA9D;IACAc,QAAAA,SAAS,CAACuB,SAAD,CAAT;IACH;IACJ,KA/BE;IAgCHC,IAAAA,IAhCG,kBAgCI;IACH,UAAMtC,KAAK,GAAGF,QAAQ,CAACG,SAAT,CAAmB,UAAAC,IAAI;IAAA,eAAIA,IAAI,CAACC,GAAL,KAAaT,MAAM,CAACU,GAAxB;IAAA,OAAvB,CAAd;IACAhB,MAAAA,WAAW,CAACY,KAAK,KAAK,CAAC,CAAZ,EAAe,0BAAf,CAAX;;IACA,UAAIF,QAAQ,CAAC0B,MAAT,KAAoB,CAAxB,EAA2B;IACvBV,QAAAA,SAAS,CAAC,CAAD,CAAT;IACH,OAFD,MAEO;IACH,YAAMyB,SAAS,GAAGvC,KAAK,GAAG,CAAR,KAAc,CAAC,CAAf,GAAmBF,QAAQ,CAAC0B,MAAT,GAAkB,CAArC,GAAyCxB,KAAK,GAAG,CAAnE;IACAc,QAAAA,SAAS,CAACyB,SAAD,CAAT;IACH;IACJ;IAzCE,GAAP;IA2CH;;IAEDC,MAAM,CAACzD,uBAAP,GAAiCA,uBAAjC;;;;;;;;"}