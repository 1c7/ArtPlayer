{"version":3,"file":"artplayer-plugin-danmu.js","sources":["../../node_modules/@babel/runtime/helpers/arrayWithHoles.js","../../node_modules/@babel/runtime/helpers/iterableToArrayLimit.js","../../node_modules/@babel/runtime/helpers/nonIterableRest.js","../../node_modules/@babel/runtime/helpers/slicedToArray.js","../../packages/artplayer-plugin-danmu/src/bilibiliDanmuParse.js","../../node_modules/@babel/runtime/helpers/defineProperty.js","../../node_modules/@babel/runtime/helpers/objectSpread.js","../../node_modules/@babel/runtime/helpers/classCallCheck.js","../../node_modules/@babel/runtime/helpers/createClass.js","../../packages/artplayer-plugin-danmu/src/danmuku.js","../../packages/artplayer-plugin-danmu/src/index.js"],"sourcesContent":["function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nmodule.exports = _arrayWithHoles;","function _iterableToArrayLimit(arr, i) {\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nmodule.exports = _iterableToArrayLimit;","function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nmodule.exports = _nonIterableRest;","var arrayWithHoles = require(\"./arrayWithHoles\");\n\nvar iterableToArrayLimit = require(\"./iterableToArrayLimit\");\n\nvar nonIterableRest = require(\"./nonIterableRest\");\n\nfunction _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || nonIterableRest();\n}\n\nmodule.exports = _slicedToArray;","export function bilibiliDanmuParseFromXml(xmlString) {\n    if (typeof xmlString !== 'string') return [];\n    const srtList = xmlString.match(/<d([\\S ]*?>[\\S ]*?)<\\/d>/gi);\n    return srtList.length\n        ? srtList.map(item => {\n            const [, attrStr, text] = item.match(/<d p=\"(.+)\">(.+)<\\/d>/);\n            const attr = attrStr.split(',');\n            return attr.length === 8 && text.trim()\n                ? {\n                    text,\n                    time: Number(attr[0]),\n                    mode: Number(attr[1]),\n                    size: Number(attr[2]),\n                    color: `#${Number(attr[3]).toString(16)}`,\n                    timestamp: Number(attr[4]),\n                    pool: Number(attr[5]),\n                    userID: attr[6],\n                    rowID: Number(attr[7]),\n                }\n                : null;\n        })\n        : [];\n}\n\nexport function bilibiliDanmuParseFromAv(av) {\n    const corsUrl = 'https://cors-anywhere.herokuapp.com/';\n    return fetch(`${corsUrl}https://api.bilibili.com/x/web-interface/view?aid=${av}`)\n        .then(res => res.json())\n        .then(res => {\n            if (res.code === 0 && res.data && res.data.cid) {\n                return fetch(`${corsUrl}https://api.bilibili.com/x/v1/dm/list.so?oid=${res.data.cid}`)\n                    .then(res => res.text())\n                    .then(xmlString => {\n                        return bilibiliDanmuParseFromXml(xmlString);\n                    });\n            }\n            throw new Error(`Unable to get data: ${JSON.stringify(res)}`);\n        });\n}","function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","var defineProperty = require(\"./defineProperty\");\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nmodule.exports = _objectSpread;","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","export default class Danmuku {\n    constructor(art, option = {}) {\n        this.art = art;\n        this.queue = [];\n        this.layer = null;\n        this.isStop = false;\n        this.timer = null;\n        this.option = Object.assign({}, Danmuku.option, option);\n        art.constructor.validator(this.option, Danmuku.scheme);\n        art.on('video:play', this.start.bind(this));\n        art.on('video:pause', this.stop.bind(this));\n        art.on('destroy', this.stop.bind(this));\n        if (typeof this.option.danmus === 'function') {\n            this.option.danmus().then(danmus => {\n                art.emit('artplayerPluginDanmu:loaded', danmus);\n                danmus.forEach(this.addToQueue.bind(this));\n                this.init();\n            });\n        } else {\n            this.option.danmus.forEach(this.addToQueue);\n            this.init();\n        }\n    }\n\n    static get option() {\n        return {\n            danmus: [],\n            speed: 5,\n            opacity: 1,\n            color: '#fff',\n            size: 14,\n            maxlength: 50,\n        };\n    }\n\n    static get scheme() {\n        return {\n            danmus: 'array|function',\n            speed: 'number',\n            opacity: 'number',\n            color: 'string',\n            size: 'number',\n            maxlength: 'number',\n        };\n    }\n\n    init() {\n        this.layer = this.art.layers.add({\n            name: 'danmu',\n            style: {\n                position: 'absolute',\n                left: 0,\n                top: 0,\n                right: 0,\n                bottom: 0,\n                width: '100%',\n                height: '100%',\n                overflow: 'hidden',\n                pointerEvents: 'none',\n            },\n        });\n    }\n\n    emit(danmu) {\n        const { errorHandle } = this.art.constructor.utils;\n        errorHandle(this.layer, 'The danmuku is not ready');\n        const { clientWidth: playerWidth, clientHeight: playerHeight } = this.art.template.$player;\n        danmu.$ref.innerText = danmu.text;\n        danmu.$ref.style.fontSize = `${danmu.size || this.option.size}px`;\n        const { clientWidth: danmuWidth, clientHeight: danmuHeight } = danmu.$ref;\n        danmu.$ref.style.opacity = danmu.opacity || this.option.opacity;\n        danmu.$ref.style.color = danmu.color || this.option.color;\n        danmu.$ref.style.top = this.getDanmuTop(playerHeight, danmuHeight);\n        danmu.$ref.style.left = `${playerWidth}px`;\n        const translateX = -playerWidth - danmuWidth - 10;\n        danmu.$ref.style.transform = `translateX(${translateX}px) translateY(0px) translateZ(0px)`;\n        danmu.$ref.style.transition = `-webkit-transform ${danmu.$restTime}s linear 0s`;\n    }\n\n    continue(danmu) {\n        danmu.$ref.style.transform = `translateX(${translateX}px) translateY(0px) translateZ(0px)`;\n        danmu.$ref.style.transition = `-webkit-transform ${danmu.$restTime}s linear 0s`;\n    }\n\n    addToQueue(danmu) {\n        const { errorHandle } = this.art.constructor.utils;\n        errorHandle(danmu.text, 'Danmu text cannot be empty');\n        errorHandle(typeof danmu.time === 'number', 'Danmu time cannot be empty');\n        errorHandle(\n            danmu.text.length <= this.option.maxlength,\n            `The length of the danmu does not exceed ${this.option.maxlength}`,\n        );\n        this.queue.push({\n            ...danmu,\n            $state: 'wait',\n            $ref: null,\n            $restTime: 0,\n            $lastPlayTime: 0,\n        });\n    }\n\n    getDanmuRef() {\n        const { $player } = this.art.template;\n        const { setStyles, append } = this.art.constructor.utils;\n        const playerLeft = $player.getBoundingClientRect().left;\n\n        const waitDanmu = this.queue.find(danmu => {\n            if (danmu.$ref) {\n                const { left, width } = danmu.$ref.getBoundingClientRect();\n                return playerLeft >= left + width;\n            }\n            return false;\n        });\n\n        if (waitDanmu) {\n            waitDanmu.$state = 'wait';\n            waitDanmu.$ref.style.transform = 'translateX(0px) translateY(0px) translateZ(0px)';\n            waitDanmu.$ref.style.transition = '-webkit-transform 0s linear 0s';\n            return waitDanmu.$ref;\n        }\n\n        const $ref = document.createElement('div');\n\n        setStyles($ref, {\n            userSelect: 'none',\n            position: 'absolute',\n            whiteSpace: 'pre',\n            pointerEvents: 'none',\n            perspective: '500px',\n            display: 'inline-block',\n            willChange: 'transform',\n            fontFamily: 'SimHei, \"Microsoft JhengHei\", Arial, Helvetica, sans-serif',\n            fontWeight: 'normal',\n            lineHeight: '1.125',\n            textShadow:\n                'rgb(0, 0, 0) 1px 0px 1px, rgb(0, 0, 0) 0px 1px 1px, rgb(0, 0, 0) 0px -1px 1px, rgb(0, 0, 0) -1px 0px 1px',\n        });\n\n        append(this.layer.$ref, $ref);\n        return $ref;\n    }\n\n    getDanmuTop(playerHeight, danmuHeight) {\n        return 0;\n    }\n\n    changeState(before, after) {\n        return this.queue\n            .filter(danmu => danmu.$state === before)\n            .map(danmu => {\n                danmu.$state = after;\n                return danmu;\n            });\n    }\n\n    update() {\n        const { player } = this.art;\n        this.timer = window.requestAnimationFrame(() => {\n            this.queue\n                .filter(danmu => {\n                    return (\n                        player.currentTime + 0.25 >= danmu.time &&\n                        danmu.time >= player.currentTime - 0.25 &&\n                        danmu.$state === 'wait'\n                    );\n                })\n                .map(danmu => {\n                    danmu.$lastPlayTime = Date.now();\n                    danmu.$restTime = this.option.speed;\n                    danmu.$ref = this.getDanmuRef();\n                    danmu.$state = 'emit';\n                    return danmu;\n                })\n                .forEach(danmu => {\n                    this.emit(danmu);\n                });\n\n            if (!this.isStop) {\n                this.update();\n            }\n        });\n    }\n\n    stop() {\n        this.isStop = true;\n        this.queue\n            .filter(danmu => danmu.$state === 'emit')\n            .forEach(danmu => {\n                danmu.$state = 'stop';\n                danmu.$restTime -= Date.now() - danmu.$lastPlayTime;\n            });\n        window.cancelAnimationFrame(this.timer);\n        this.art.emit('artplayerPluginDanmu:stop');\n    }\n\n    start() {\n        this.isStop = false;\n        this.queue\n            .filter(danmu => danmu.$state === 'stop')\n            .forEach(danmu => {\n                danmu.$state = 'emit';\n                danmu.$lastPlayTime = Date.now();\n            });\n        this.update();\n        this.art.emit('artplayerPluginDanmu:start');\n    }\n\n    show() {\n        this.layer.$ref.style = 'none';\n        this.art.emit('artplayerPluginDanmu:show');\n    }\n\n    hide() {\n        this.layer.$ref.style = 'block';\n        this.art.emit('artplayerPluginDanmu:hide');\n    }\n}\n","import { bilibiliDanmuParseFromXml, bilibiliDanmuParseFromAv } from './bilibiliDanmuParse';\nimport Danmuku from './danmuku';\n\nfunction artplayerPluginDanmu(option) {\n    return art => {\n        const danmuku = new Danmuku(art, option);\n        return {\n            name: 'artplayerPluginDanmu',\n            emit: danmuku.addToQueue.bind(danmuku),\n            start: danmuku.start.bind(danmuku),\n            stop: danmuku.stop.bind(danmuku),\n            hide: danmuku.hide.bind(danmuku),\n            show: danmuku.show.bind(danmuku),\n        };\n    };\n}\n\nartplayerPluginDanmu.bilibiliDanmuParseFromXml = bilibiliDanmuParseFromXml;\nartplayerPluginDanmu.bilibiliDanmuParseFromAv = bilibiliDanmuParseFromAv;\nwindow.artplayerPluginDanmu = artplayerPluginDanmu;\nexport default artplayerPluginDanmu;\n"],"names":["bilibiliDanmuParseFromXml","xmlString","srtList","match","length","map","item","attrStr","text","attr","split","trim","time","Number","mode","size","color","toString","timestamp","pool","userID","rowID","bilibiliDanmuParseFromAv","av","corsUrl","fetch","then","res","json","code","data","cid","Error","JSON","stringify","Danmuku","art","option","queue","layer","isStop","timer","Object","assign","constructor","validator","scheme","on","start","bind","stop","danmus","emit","forEach","addToQueue","init","layers","add","name","style","position","left","top","right","bottom","width","height","overflow","pointerEvents","danmu","errorHandle","utils","template","$player","playerWidth","clientWidth","playerHeight","clientHeight","$ref","innerText","fontSize","danmuWidth","danmuHeight","opacity","getDanmuTop","translateX","transform","transition","$restTime","maxlength","push","$state","$lastPlayTime","setStyles","append","playerLeft","getBoundingClientRect","waitDanmu","find","document","createElement","userSelect","whiteSpace","perspective","display","willChange","fontFamily","fontWeight","lineHeight","textShadow","before","after","filter","player","window","requestAnimationFrame","currentTime","Date","now","speed","getDanmuRef","update","cancelAnimationFrame","artplayerPluginDanmu","danmuku","hide","show"],"mappings":"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"}