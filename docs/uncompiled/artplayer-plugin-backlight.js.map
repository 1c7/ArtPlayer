{"version":3,"file":"artplayer-plugin-backlight.js","sources":["../../packages/artplayer-plugin-backlight/src/index.js"],"sourcesContent":["function getAverageColor(img, left, top, width, height) {\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    canvas.width = width;\n    canvas.height = height;\n    ctx.drawImage(img, -left, -top);\n    const imageData = ctx.getImageData(0, 0, width, height);\n    const { data } = imageData;\n    let r = 0;\n    let g = 0;\n    let b = 0;\n    for (let i = 0, l = data.length; i < l; i += 4) {\n        r += data[i];\n        g += data[i + 1];\n        b += data[i + 2];\n    }\n\n    r = Math.floor(r / (data.length / 4));\n    g = Math.floor(g / (data.length / 4));\n    b = Math.floor(b / (data.length / 4));\n\n    return { r, g, b };\n}\n\nfunction matrixCallback(callback) {\n    const result = [];\n    const x = 10;\n    const y = 5;\n    for (let xIndex = 0; xIndex < x; xIndex += 1) {\n        for (let yIndex = 0; yIndex < y; yIndex += 1) {\n            if (xIndex === 0 || xIndex === x - 1 || yIndex === 0 || yIndex === y - 1) {\n                result.push(callback(xIndex, yIndex, x, y));\n            }\n        }\n    }\n    return result;\n}\n\nfunction getColors($img, width, height) {\n    return matrixCallback((xIndex, yIndex, x, y) => {\n        return getAverageColor($img, (xIndex * width) / x, (yIndex * height) / y, width / x, height / y);\n    });\n}\n\nfunction creatMatrix(parent, width, height) {\n    return matrixCallback((xIndex, yIndex, x, y) => {\n        const $box = document.createElement('div');\n        $box.style.position = 'absolute';\n        $box.style.left = `${(xIndex * width) / x}px`;\n        $box.style.top = `${(yIndex * height) / y}px`;\n        $box.style.width = `${100 / x}%`;\n        $box.style.height = `${100 / y}%`;\n        $box.style.webkitTransition = 'all .2s ease';\n        $box.style.transition = 'all .2s ease';\n        parent.appendChild($box);\n        return {\n            $box,\n            left: xIndex === 0,\n            right: xIndex === x - 1,\n            top: yIndex === 0,\n            bottom: yIndex === y - 1,\n        };\n    });\n}\n\nfunction artplayerPluginBacklight(art) {\n    const { setStyles } = art.constructor.utils;\n    const {\n        template: { $player, $video },\n        player,\n    } = art;\n\n    const $backlight = document.createElement('div');\n    $backlight.classList.add('artplayer-backlight');\n    setStyles($backlight, {\n        position: 'absolute',\n        zIndex: 9,\n        left: 0,\n        top: 0,\n        right: 0,\n        bottom: 0,\n        width: '100%',\n        height: '100%',\n    });\n\n    $player.insertBefore($backlight, $video);\n\n    art.on('firstCanplay', () => {\n        const { clientWidth, clientHeight } = $video;\n        const matrix = creatMatrix($backlight, clientWidth, clientHeight);\n        art.on('video:timeupdate', () => {\n            const dataUri = player.getScreenshotDataURL();\n            const $img = document.createElement('img');\n            $img.onload = () => {\n                const colors = getColors($img, clientWidth, clientHeight);\n                colors.forEach(({ r, g, b }, index) => {\n                    const { $box, left, right, top, bottom } = matrix[index];\n                    // eslint-disable-next-line no-nested-ternary\n                    const x = left ? '-60px' : right ? '60px' : '0';\n                    // eslint-disable-next-line no-nested-ternary\n                    const y = top ? '-60px' : bottom ? '60px' : '0';\n                    $box.style.webkitBoxShadow = `rgb(${r}, ${g}, ${b}) ${x} ${y} 120px`;\n                    $box.style.boxShadow = `rgb(${r}, ${g}, ${b}) ${x} ${y} 120px`;\n                });\n            };\n            $img.src = dataUri;\n        });\n    });\n\n    return {\n        name: 'artplayerPluginBacklight',\n    };\n}\n\nwindow.artplayerPluginBacklight = artplayerPluginBacklight;\nexport default artplayerPluginBacklight;\n"],"names":["getAverageColor","img","left","top","width","height","canvas","document","createElement","ctx","getContext","drawImage","imageData","getImageData","data","r","g","b","i","l","length","Math","floor","matrixCallback","callback","result","x","y","xIndex","yIndex","push","getColors","$img","creatMatrix","parent","$box","style","position","webkitTransition","transition","appendChild","right","bottom","artplayerPluginBacklight","art","setStyles","constructor","utils","template","$player","$video","player","$backlight","classList","add","zIndex","insertBefore","on","clientWidth","clientHeight","matrix","dataUri","getScreenshotDataURL","onload","colors","forEach","index","webkitBoxShadow","boxShadow","src","name","window"],"mappings":";;;;;;IAAA,SAASA,eAAT,CAAyBC,GAAzB,EAA8BC,IAA9B,EAAoCC,GAApC,EAAyCC,KAAzC,EAAgDC,MAAhD,EAAwD;IACpD,MAAMC,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAf;IACA,MAAMC,GAAG,GAAGH,MAAM,CAACI,UAAP,CAAkB,IAAlB,CAAZ;IACAJ,EAAAA,MAAM,CAACF,KAAP,GAAeA,KAAf;IACAE,EAAAA,MAAM,CAACD,MAAP,GAAgBA,MAAhB;IACAI,EAAAA,GAAG,CAACE,SAAJ,CAAcV,GAAd,EAAmB,CAACC,IAApB,EAA0B,CAACC,GAA3B;IACA,MAAMS,SAAS,GAAGH,GAAG,CAACI,YAAJ,CAAiB,CAAjB,EAAoB,CAApB,EAAuBT,KAAvB,EAA8BC,MAA9B,CAAlB;IANoD,MAO5CS,IAP4C,GAOnCF,SAPmC,CAO5CE,IAP4C;IAQpD,MAAIC,CAAC,GAAG,CAAR;IACA,MAAIC,CAAC,GAAG,CAAR;IACA,MAAIC,CAAC,GAAG,CAAR;;IACA,OAAK,IAAIC,CAAC,GAAG,CAAR,EAAWC,CAAC,GAAGL,IAAI,CAACM,MAAzB,EAAiCF,CAAC,GAAGC,CAArC,EAAwCD,CAAC,IAAI,CAA7C,EAAgD;IAC5CH,IAAAA,CAAC,IAAID,IAAI,CAACI,CAAD,CAAT;IACAF,IAAAA,CAAC,IAAIF,IAAI,CAACI,CAAC,GAAG,CAAL,CAAT;IACAD,IAAAA,CAAC,IAAIH,IAAI,CAACI,CAAC,GAAG,CAAL,CAAT;IACH;;IAEDH,EAAAA,CAAC,GAAGM,IAAI,CAACC,KAAL,CAAWP,CAAC,IAAID,IAAI,CAACM,MAAL,GAAc,CAAlB,CAAZ,CAAJ;IACAJ,EAAAA,CAAC,GAAGK,IAAI,CAACC,KAAL,CAAWN,CAAC,IAAIF,IAAI,CAACM,MAAL,GAAc,CAAlB,CAAZ,CAAJ;IACAH,EAAAA,CAAC,GAAGI,IAAI,CAACC,KAAL,CAAWL,CAAC,IAAIH,IAAI,CAACM,MAAL,GAAc,CAAlB,CAAZ,CAAJ;IAEA,SAAO;IAAEL,IAAAA,CAAC,EAADA,CAAF;IAAKC,IAAAA,CAAC,EAADA,CAAL;IAAQC,IAAAA,CAAC,EAADA;IAAR,GAAP;IACH;;IAED,SAASM,cAAT,CAAwBC,QAAxB,EAAkC;IAC9B,MAAMC,MAAM,GAAG,EAAf;IACA,MAAMC,CAAC,GAAG,EAAV;IACA,MAAMC,CAAC,GAAG,CAAV;;IACA,OAAK,IAAIC,MAAM,GAAG,CAAlB,EAAqBA,MAAM,GAAGF,CAA9B,EAAiCE,MAAM,IAAI,CAA3C,EAA8C;IAC1C,SAAK,IAAIC,MAAM,GAAG,CAAlB,EAAqBA,MAAM,GAAGF,CAA9B,EAAiCE,MAAM,IAAI,CAA3C,EAA8C;IAC1C,UAAID,MAAM,KAAK,CAAX,IAAgBA,MAAM,KAAKF,CAAC,GAAG,CAA/B,IAAoCG,MAAM,KAAK,CAA/C,IAAoDA,MAAM,KAAKF,CAAC,GAAG,CAAvE,EAA0E;IACtEF,QAAAA,MAAM,CAACK,IAAP,CAAYN,QAAQ,CAACI,MAAD,EAASC,MAAT,EAAiBH,CAAjB,EAAoBC,CAApB,CAApB;IACH;IACJ;IACJ;;IACD,SAAOF,MAAP;IACH;;IAED,SAASM,SAAT,CAAmBC,IAAnB,EAAyB5B,KAAzB,EAAgCC,MAAhC,EAAwC;IACpC,SAAOkB,cAAc,CAAC,UAACK,MAAD,EAASC,MAAT,EAAiBH,CAAjB,EAAoBC,CAApB,EAA0B;IAC5C,WAAO3B,eAAe,CAACgC,IAAD,EAAQJ,MAAM,GAAGxB,KAAV,GAAmBsB,CAA1B,EAA8BG,MAAM,GAAGxB,MAAV,GAAoBsB,CAAjD,EAAoDvB,KAAK,GAAGsB,CAA5D,EAA+DrB,MAAM,GAAGsB,CAAxE,CAAtB;IACH,GAFoB,CAArB;IAGH;;IAED,SAASM,WAAT,CAAqBC,MAArB,EAA6B9B,KAA7B,EAAoCC,MAApC,EAA4C;IACxC,SAAOkB,cAAc,CAAC,UAACK,MAAD,EAASC,MAAT,EAAiBH,CAAjB,EAAoBC,CAApB,EAA0B;IAC5C,QAAMQ,IAAI,GAAG5B,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAb;IACA2B,IAAAA,IAAI,CAACC,KAAL,CAAWC,QAAX,GAAsB,UAAtB;IACAF,IAAAA,IAAI,CAACC,KAAL,CAAWlC,IAAX,aAAsB0B,MAAM,GAAGxB,KAAV,GAAmBsB,CAAxC;IACAS,IAAAA,IAAI,CAACC,KAAL,CAAWjC,GAAX,aAAqB0B,MAAM,GAAGxB,MAAV,GAAoBsB,CAAxC;IACAQ,IAAAA,IAAI,CAACC,KAAL,CAAWhC,KAAX,aAAsB,MAAMsB,CAA5B;IACAS,IAAAA,IAAI,CAACC,KAAL,CAAW/B,MAAX,aAAuB,MAAMsB,CAA7B;IACAQ,IAAAA,IAAI,CAACC,KAAL,CAAWE,gBAAX,GAA8B,cAA9B;IACAH,IAAAA,IAAI,CAACC,KAAL,CAAWG,UAAX,GAAwB,cAAxB;IACAL,IAAAA,MAAM,CAACM,WAAP,CAAmBL,IAAnB;IACA,WAAO;IACHA,MAAAA,IAAI,EAAJA,IADG;IAEHjC,MAAAA,IAAI,EAAE0B,MAAM,KAAK,CAFd;IAGHa,MAAAA,KAAK,EAAEb,MAAM,KAAKF,CAAC,GAAG,CAHnB;IAIHvB,MAAAA,GAAG,EAAE0B,MAAM,KAAK,CAJb;IAKHa,MAAAA,MAAM,EAAEb,MAAM,KAAKF,CAAC,GAAG;IALpB,KAAP;IAOH,GAjBoB,CAArB;IAkBH;;IAED,SAASgB,wBAAT,CAAkCC,GAAlC,EAAuC;IAAA,MAC3BC,SAD2B,GACbD,GAAG,CAACE,WAAJ,CAAgBC,KADH,CAC3BF,SAD2B;IAAA,sBAK/BD,GAL+B,CAG/BI,QAH+B;IAAA,MAGnBC,OAHmB,iBAGnBA,OAHmB;IAAA,MAGVC,MAHU,iBAGVA,MAHU;IAAA,MAI/BC,MAJ+B,GAK/BP,GAL+B,CAI/BO,MAJ+B;IAOnC,MAAMC,UAAU,GAAG7C,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAnB;IACA4C,EAAAA,UAAU,CAACC,SAAX,CAAqBC,GAArB,CAAyB,qBAAzB;IACAT,EAAAA,SAAS,CAACO,UAAD,EAAa;IAClBf,IAAAA,QAAQ,EAAE,UADQ;IAElBkB,IAAAA,MAAM,EAAE,CAFU;IAGlBrD,IAAAA,IAAI,EAAE,CAHY;IAIlBC,IAAAA,GAAG,EAAE,CAJa;IAKlBsC,IAAAA,KAAK,EAAE,CALW;IAMlBC,IAAAA,MAAM,EAAE,CANU;IAOlBtC,IAAAA,KAAK,EAAE,MAPW;IAQlBC,IAAAA,MAAM,EAAE;IARU,GAAb,CAAT;IAWA4C,EAAAA,OAAO,CAACO,YAAR,CAAqBJ,UAArB,EAAiCF,MAAjC;IAEAN,EAAAA,GAAG,CAACa,EAAJ,CAAO,cAAP,EAAuB,YAAM;IAAA,QACjBC,WADiB,GACaR,MADb,CACjBQ,WADiB;IAAA,QACJC,YADI,GACaT,MADb,CACJS,YADI;IAEzB,QAAMC,MAAM,GAAG3B,WAAW,CAACmB,UAAD,EAAaM,WAAb,EAA0BC,YAA1B,CAA1B;IACAf,IAAAA,GAAG,CAACa,EAAJ,CAAO,kBAAP,EAA2B,YAAM;IAC7B,UAAMI,OAAO,GAAGV,MAAM,CAACW,oBAAP,EAAhB;IACA,UAAM9B,IAAI,GAAGzB,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAb;;IACAwB,MAAAA,IAAI,CAAC+B,MAAL,GAAc,YAAM;IAChB,YAAMC,MAAM,GAAGjC,SAAS,CAACC,IAAD,EAAO0B,WAAP,EAAoBC,YAApB,CAAxB;IACAK,QAAAA,MAAM,CAACC,OAAP,CAAe,gBAAcC,KAAd,EAAwB;IAAA,cAArBnD,CAAqB,QAArBA,CAAqB;IAAA,cAAlBC,CAAkB,QAAlBA,CAAkB;IAAA,cAAfC,CAAe,QAAfA,CAAe;IAAA,8BACQ2C,MAAM,CAACM,KAAD,CADd;IAAA,cAC3B/B,IAD2B,iBAC3BA,IAD2B;IAAA,cACrBjC,IADqB,iBACrBA,IADqB;IAAA,cACfuC,KADe,iBACfA,KADe;IAAA,cACRtC,GADQ,iBACRA,GADQ;IAAA,cACHuC,MADG,iBACHA,MADG;;IAGnC,cAAMhB,CAAC,GAAGxB,IAAI,GAAG,OAAH,GAAauC,KAAK,GAAG,MAAH,GAAY,GAA5C,CAHmC;;IAKnC,cAAMd,CAAC,GAAGxB,GAAG,GAAG,OAAH,GAAauC,MAAM,GAAG,MAAH,GAAY,GAA5C;IACAP,UAAAA,IAAI,CAACC,KAAL,CAAW+B,eAAX,iBAAoCpD,CAApC,eAA0CC,CAA1C,eAAgDC,CAAhD,eAAsDS,CAAtD,cAA2DC,CAA3D;IACAQ,UAAAA,IAAI,CAACC,KAAL,CAAWgC,SAAX,iBAA8BrD,CAA9B,eAAoCC,CAApC,eAA0CC,CAA1C,eAAgDS,CAAhD,cAAqDC,CAArD;IACH,SARD;IASH,OAXD;;IAYAK,MAAAA,IAAI,CAACqC,GAAL,GAAWR,OAAX;IACH,KAhBD;IAiBH,GApBD;IAsBA,SAAO;IACHS,IAAAA,IAAI,EAAE;IADH,GAAP;IAGH;;IAEDC,MAAM,CAAC5B,wBAAP,GAAkCA,wBAAlC;;;;;;;;"}