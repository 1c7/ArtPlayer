{"version":3,"file":"artplayer-plugin-subtitle.js","sources":["../../../packages/artplayer-plugin-subtitle/src/index.js"],"sourcesContent":["function i18nMix(i18n) {\n    i18n.update({\n        'zh-cn': {\n            'Subtitle offset time': '字幕偏移时间',\n        },\n        'zh-tw': {\n            'Subtitle offset time': '字幕偏移時間',\n        },\n    });\n}\n\nfunction settingMix(art) {\n    const {\n        i18n,\n        events: { proxy },\n    } = art;\n    return {\n        title: 'Subtitle',\n        name: 'subtitle',\n        index: 20,\n        html: `\n            <div class=\"art-setting-header\">\n                ${i18n.get('Subtitle offset time')}: <span class=\"art-subtitle-value\">0</span>s\n            </div>\n            <div class=\"art-setting-body\">\n                <input\n                    style=\"width: 100%;height: 3px;outline: none;appearance: none;-moz-appearance: none;-webkit-appearance: none;background-color: #fff;\"\n                    class=\"art-subtitle-range\"\n                    type=\"range\"\n                    min=\"-5\"\n                    max=\"5\"\n                    step=\"0.5\"\n                >\n            </div>\n        `,\n        mounted: $setting => {\n            const $range = $setting.querySelector('.art-subtitle-range');\n            const $value = $setting.querySelector('.art-subtitle-value');\n            proxy($range, 'change', () => {\n                const { value } = $range;\n                $value.innerText = value;\n                art.plugins.artplayerPluginSubtitle.set(Number(value));\n            });\n\n            art.on('subtitle:switch', () => {\n                $range.value = 0;\n                $value.innerText = 0;\n            });\n\n            art.on('artplayerPluginSubtitle:set', value => {\n                if ($range.value !== value) {\n                    $range.value = value;\n                    $value.innerText = value;\n                }\n            });\n        },\n    };\n}\n\nfunction artplayerPluginSubtitle(art) {\n    const { clamp } = art.constructor.utils;\n    const { setting, notice, template, i18n } = art;\n    i18nMix(i18n);\n    setting.add(settingMix);\n    \n    let cuesCache = [];\n    art.on('subtitle:switch', () => {\n        cuesCache = [];\n    });\n\n    return {\n        set(value) {\n            const cues = Array.from(template.$track.track.cues);\n            const time = clamp(value, -5, 5);\n            cues.forEach((cue, index) => {\n                if (!cuesCache[index]) {\n                    cuesCache[index] = {\n                        startTime: cue.startTime,\n                        endTime: cue.endTime,\n                    };\n                }\n                cue.startTime = cuesCache[index].startTime + time;\n                cue.endTime = cuesCache[index].endTime + time;\n            });\n            notice.show(`${i18n.get('Subtitle offset time')}: ${value}s`);\n            art.emit('artplayerPluginSubtitle:set', value);\n        },\n    };\n}\n\nwindow.artplayerPluginSubtitle = artplayerPluginSubtitle;\nexport default artplayerPluginSubtitle;\n"],"names":["i18nMix","i18n","update","settingMix","art","proxy","events","title","name","index","html","get","mounted","$setting","$range","querySelector","$value","value","innerText","plugins","artplayerPluginSubtitle","set","Number","on","clamp","constructor","utils","setting","notice","template","add","cuesCache","cues","Array","from","$track","track","time","forEach","cue","startTime","endTime","show","emit","window"],"mappings":"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"}